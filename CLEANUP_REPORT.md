# üßπ –û—Ç—á—ë—Ç –ø–æ –æ—á–∏—Å—Ç–∫–µ —Å–∏—Å—Ç–µ–º—ã
**–î–∞—Ç–∞:** 21 –Ω–æ—è–±—Ä—è 2025  
**–ú–∏–≥—Ä–∞—Ü–∏—è:** V0083__fix_ker_balance.sql

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ker ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `ker` (ID 1000015) –∏–º–µ–ª –±–∞–ª–∞–Ω—Å 14,260 –±–∞–ª–ª–æ–≤
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Ç–æ–ª—å–∫–æ –Ω–∞ 100 –±–∞–ª–ª–æ–≤
- –†–∞–∑–Ω–∏—Ü–∞: **+14,160** –±–∞–ª–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:
```sql
INSERT INTO transactions (user_id, amount, type, description)
VALUES (1000015, 14160, 'refill', '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ—Å–ª–µ –∞—É–¥–∏—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –±–∞–ª–ª–æ–≤');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ID 62
- ‚úÖ –ë–∞–ª–∞–Ω—Å —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—É–º–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- ‚ö†Ô∏è –ù–æ–≤–∞—è —Ä–∞–∑–Ω–∏—Ü–∞: +1,400 (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞–ª –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ker:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ë–∞–ª–∞–Ω—Å | 15,660 |
| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | 2 |
| –°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | 14,260 |
| –†–∞–∑–Ω–∏—Ü–∞ | +1,400 |

---

### 2. –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ä—ã—Ö pending –∑–∞–∫–∞–∑–æ–≤ ‚úÖ

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –í—Å–µ–≥–æ pending –∑–∞–∫–∞–∑–æ–≤: **33**
- –°—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π: **27** (82%)
- –ù–æ–≤–µ–µ 7 –¥–Ω–µ–π: **6** (18%)
- –í—Å–µ –∑–∞–∫–∞–∑—ã –æ—Ç: **admin (ID 999999)**

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É:**
| –í–æ–∑—Ä–∞—Å—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|---------|------------|
| < 1 –¥–µ–Ω—å | 3 |
| 1-7 –¥–Ω–µ–π | 3 |
| 7-10 –¥–Ω–µ–π | 27 |

**–ü–æ—á–µ–º—É –Ω–µ —É–¥–∞–ª–µ–Ω—ã:**
- ‚ùå DELETE –∑–∞–ø—Ä–µ—â—ë–Ω –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö (–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö)
- ‚ùå –ü–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ 'cancelled' –Ω–µ —É–¥–∞–ª–∞—Å—å (–Ω–∞—Ä—É—à–µ–Ω–∏–µ constraint)
- ‚ÑπÔ∏è –í—Å–µ –∑–∞–∫–∞–∑—ã –æ—Ç –∞–¥–º–∏–Ω–∞, –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å. –≠—Ç–∏ –∑–∞–∫–∞–∑—ã:
- –ù–µ –º–µ—à–∞—é—Ç —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º—ã
- –í—Å–µ –æ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
- –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ë–î –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- –í—Å–µ–≥–æ: 12
- –° –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º: 11 ‚úÖ
- –° –Ω–µ–±–æ–ª—å—à–∏–º —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ–º: 1 ‚ö†Ô∏è (ker, +1400 –±–∞–ª–ª–æ–≤)

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
- –í—Å–µ–≥–æ: 12 (–±—ã–ª–æ 11)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—â–∏—Ö: 1

**–ü–æ–∫—É–ø–∫–∏:**
- –í—Å–µ–≥–æ: 29 (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –ü–æ–∫—É–ø–æ–∫ –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: 0 ‚úÖ

**–ó–∞–∫–∞–∑—ã:**
- –í—Å–µ–≥–æ pending: 33
- –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ –∫ —É–¥–∞–ª–µ–Ω–∏—é: 27 (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
- –ê–∫—Ç—É–∞–ª—å–Ω—ã—Ö: 6

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ pending –∑–∞–∫–∞–∑—ã, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:

```sql
-- –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å PostgreSQL:
DELETE FROM t_p63326274_course_download_plat.orders 
WHERE status = 'pending' 
  AND created_at < NOW() - INTERVAL '7 days';
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å–∞ ker:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ker:
SELECT 
  u.balance,
  COALESCE(SUM(t.amount), 0) as sum_transactions,
  u.balance - COALESCE(SUM(t.amount), 0) as difference
FROM users u
LEFT JOIN transactions t ON t.user_id = u.id
WHERE u.id = 1000015
GROUP BY u.id, u.balance;
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

**–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!**

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞:
- ‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ker –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (–¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ 14,160)
- ‚ÑπÔ∏è –°—Ç–∞—Ä—ã–µ pending –∑–∞–∫–∞–∑—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–Ω–µ —É–¥–∞–ª–µ–Ω—ã –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã.

---

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** –Æ—Ä–∞ (poehali.dev AI assistant)  
**–î–∞—Ç–∞:** 21 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:** V0083
