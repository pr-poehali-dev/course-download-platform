# Руководство по настройке правильной обработки 404 ошибок

## Проблема
React SPA приложения не могут изменять HTTP статус ответа сервера. Когда пользователь попадает на несуществующую страницу, сервер возвращает `index.html` со статусом **200 OK** вместо **404 Not Found**.

## Решение

### 1. Статический файл 404.html
Создан файл `public/404.html` который:
- Содержит Title: **"Ошибка 404: Страница не найдена"**
- Включает meta-тег `<meta http-equiv="status" content="404">`
- Отправляет событие в Яндекс.Метрику
- Предлагает пользователю навигацию по сайту

### 2. Конфигурация для разных платформ

#### Apache (.htaccess)
Файл `public/.htaccess` настроен:
```apache
ErrorDocument 404 /404.html
```

#### Nginx
Файл `nginx.conf` содержит полную конфигурацию:
- Проверяет известные маршруты React
- Для несуществующих страниц возвращает 404.html со статусом 404
- Использует `error_page 404 /404.html;`

#### Vercel
Файл `vercel.json` настроен с правильными rewrites.

### 3. React-роутинг (NotFoundPage.tsx)
Компонент `NotFoundPage` содержит:
- Title: **"Ошибка 404: Страница не найдена"**
- Meta-теги для SEO (noindex, nofollow)
- Отправку событий в аналитику
- Поиск и навигацию

## Как проверить правильность работы

### Проверка HTTP статуса
```bash
curl -I https://techforma.pro/non-existent-page
```

Должен вернуть:
```
HTTP/2 404
```

### Проверка в браузере
1. Откройте DevTools (F12)
2. Перейдите на вкладку Network
3. Введите в адресной строке несуществующий URL
4. Проверьте статус ответа - должен быть **404**

### Проверка для поисковых систем
Используйте инструменты:
- [Google Search Console](https://search.google.com/search-console)
- [Яндекс.Вебмастер](https://webmaster.yandex.ru/)
- [Screaming Frog SEO Spider](https://www.screamingfrog.co.uk/seo-spider/)

## Настройка для вашего хостинга

### Для Apache/cPanel
1. Убедитесь, что файл `public/.htaccess` скопирован в корень сайта
2. Проверьте, что `mod_rewrite` включен

### Для Nginx
1. Используйте конфигурацию из `nginx.conf`
2. Обновите пути к SSL сертификатам
3. Перезапустите Nginx: `sudo systemctl restart nginx`

### Для Vercel/Netlify
1. Файлы конфигурации уже настроены (`vercel.json`)
2. После деплоя проверьте статус 404 через curl

### Для других хостингов
Обратитесь к документации вашего хостинга о настройке custom error pages.

## Важные моменты

1. **Title страницы**: Обязательно должен быть "Ошибка 404: Страница не найдена"
2. **HTTP статус**: Сервер должен возвращать код **404**, а не 200
3. **Robots meta**: Страница 404 должна иметь `noindex, nofollow`
4. **Аналитика**: События 404 отправляются в Яндекс.Метрику для отслеживания битых ссылок

## Список файлов

- `public/404.html` - Статический файл 404 (отдаётся со статусом 404)
- `src/pages/NotFoundPage.tsx` - React компонент (для SPA маршрутизации)
- `public/.htaccess` - Конфигурация Apache
- `nginx.conf` - Конфигурация Nginx
- `vercel.json` - Конфигурация Vercel
- `backend/handle-404/` - Серверная функция для обработки 404 (опционально)

## Мониторинг

После настройки следите за:
- События "404_error" в Яндекс.Метрике
- Отчёты об ошибках в Search Console / Вебмастере
- Логи сервера на наличие битых ссылок

## Дополнительная помощь

Если после настройки страницы 404 всё ещё отдают статус 200:
1. Проверьте конфигурацию веб-сервера
2. Убедитесь, что `.htaccess` / `nginx.conf` применяются
3. Очистите CDN кеш (если используется Cloudflare и т.п.)
4. Обратитесь в поддержку хостинга
